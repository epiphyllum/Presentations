<div class="highlight"><pre><span class="k">def</span> <span class="n">square</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>

<span class="k">val</span> <span class="n">obj</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>

<span class="k">val</span> <span class="n">squared</span> <span class="k">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">square</span><span class="o">)</span>

<span class="k">def</span> <span class="n">use</span><span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="nc">Int</span><span class="o">)(</span><span class="n">obj</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span> <span class="k">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>

<span class="k">def</span> <span class="n">lift</span><span class="o">(</span><span class="n">obj</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>

<span class="c1">//generalize - part 1</span>
<span class="k">def</span> <span class="n">lift</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="k">=</span> <span class="k">new</span><span class="o">{</span>
	<span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">fn</span><span class="k">:</span> <span class="kt">Functor</span><span class="o">[</span><span class="kt">F</span><span class="o">])</span> <span class="k">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">)(</span><span class="n">f</span><span class="o">)</span>
<span class="o">}</span> 

<span class="k">val</span> <span class="n">listSquare</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="nc">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="n">lift</span><span class="o">[</span><span class="kt">List</span><span class="o">](</span><span class="n">square</span><span class="o">)</span>

<span class="c1">//lifts</span>

<span class="k">def</span> <span class="n">addMap</span><span class="o">(</span><span class="n">list1</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">],</span> <span class="n">list2</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
	<span class="n">liftM2</span><span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">)(</span><span class="n">lift1</span><span class="o">,</span> <span class="n">lift2</span><span class="o">)</span>

<span class="k">def</span> <span class="n">addMap</span><span class="o">(</span><span class="n">list1</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">],</span> <span class="n">list2</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
	<span class="k">for</span><span class="o">{</span>
		<span class="n">item1</span> <span class="k">&lt;-</span> <span class="n">list1</span>
		<span class="n">item2</span> <span class="k">&lt;-</span> <span class="n">list2</span>
	<span class="o">}</span> <span class="k">yield</span> <span class="n">item1</span> <span class="o">+</span> <span class="n">item2</span>


<span class="k">def</span> <span class="n">liftM2</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span>, <span class="kt">C</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span> <span class="kt">B</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">C</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span><span class="o">{</span>
	<span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">M</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="n">ma</span><span class="k">:</span> <span class="kt">M</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">mb</span><span class="k">:</span> <span class="kt">M</span><span class="o">[</span><span class="kt">B</span><span class="o">])(</span><span class="k">implicit</span> <span class="n">m</span><span class="k">:</span> <span class="kt">Monad</span><span class="o">[</span><span class="kt">M</span><span class="o">])</span> <span class="k">=</span>
		<span class="n">m</span><span class="o">.</span><span class="n">bind</span><span class="o">(</span><span class="n">ma</span><span class="o">){</span> <span class="n">a</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">mb</span><span class="o">){</span> <span class="n">b</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=&gt;</span> <span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">}}</span>
<span class="o">}</span>

<span class="k">def</span> <span class="n">notperfect</span><span class="o">(</span><span class="n">fl1</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]],</span> <span class="n">fl2</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]])</span> <span class="k">=</span> <span class="k">for</span><span class="o">{</span>
	<span class="n">list1</span> <span class="k">&lt;-</span> <span class="n">fl1</span>
	<span class="n">list2</span> <span class="k">&lt;-</span> <span class="n">fl2</span>
<span class="o">}</span> <span class="k">yield</span> <span class="n">liftM2</span><span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">)(</span><span class="n">list1</span><span class="o">,</span> <span class="n">list2</span><span class="o">)</span>

<span class="k">def</span> <span class="n">better</span><span class="o">(</span><span class="n">fl1</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]],</span> <span class="n">fl2</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]])</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span>
	<span class="n">liftM2</span><span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">)(</span><span class="n">fl1</span><span class="o">,</span> <span class="n">fl2</span><span class="o">)</span>

<span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">G</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>, <span class="kt">H</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="n">gha</span><span class="k">:</span> <span class="kt">G</span><span class="o">[</span><span class="kt">H</span><span class="o">[</span><span class="kt">A</span><span class="o">]])(</span><span class="k">implicit</span> <span class="n">g</span><span class="k">:</span> <span class="kt">Monad</span><span class="o">[</span><span class="kt">G</span><span class="o">],</span> <span class="n">h</span><span class="k">:</span> <span class="kt">Monad</span><span class="o">[</span><span class="kt">H</span><span class="o">])</span> <span class="k">=</span> 
	<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">gha</span><span class="o">){</span> <span class="n">ha</span><span class="k">:</span> <span class="kt">H</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">h</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">ha</span><span class="o">)(</span><span class="n">f</span><span class="o">)</span> <span class="o">}</span>

<span class="c1">//more stuff</span>

<span class="k">def</span> <span class="n">liftM</span><span class="o">[</span><span class="kt">M</span><span class="o">[</span><span class="k">_</span><span class="o">]</span> <span class="kt">:</span> <span class="kt">Monad</span><span class="o">]</span><span class="k">:</span> <span class="kt">M</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">M</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
	<span class="o">{</span> <span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span> <span class="o">=&gt;</span> <span class="kt">B</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">implicitly</span><span class="o">[</span><span class="kt">Monad</span><span class="o">[</span><span class="kt">M</span><span class="o">]].</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">)(</span><span class="n">f</span><span class="o">)</span> <span class="o">}</span>

<span class="k">val</span> <span class="n">listSquare</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="nc">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="n">liftM</span><span class="o">[</span><span class="kt">List</span><span class="o">](</span><span class="n">squared</span><span class="o">)</span>

<span class="c1">//more ideas</span>

<span class="k">val</span> <span class="n">listOpt</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="nc">Option</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">Option</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
<span class="k">val</span> <span class="n">stuff</span> <span class="k">=</span> <span class="n">listOpt</span><span class="o">.</span><span class="n">map</span><span class="o">{</span>
	<span class="k">_</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">square</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">flOpt</span> <span class="k">=</span> <span class="nc">Future</span><span class="o">{</span> <span class="nc">List</span><span class="o">(</span><span class="nc">Option</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">Option</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span> <span class="o">}</span>
<span class="k">val</span> <span class="n">moreStuff</span> <span class="k">=</span> <span class="n">flOpt</span><span class="o">.</span><span class="n">map</span><span class="o">{</span> <span class="k">_</span><span class="o">.</span><span class="n">map</span><span class="o">{</span> <span class="k">_</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">square</span><span class="o">)</span> <span class="o">}</span> <span class="o">}</span>

<span class="k">val</span> <span class="n">srlsly</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Validation</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Things</span><span class="o">]]]]</span> <span class="k">=</span> <span class="o">...</span>

<span class="k">val</span> <span class="n">crazy</span> <span class="k">=</span> <span class="n">liftM</span><span class="o">[</span><span class="kt">Future</span><span class="o">]</span> <span class="n">compose</span> 
	<span class="n">liftM</span><span class="o">[</span><span class="kt">Option</span><span class="o">]</span> <span class="n">compose</span> 
	<span class="n">liftM</span><span class="o">[</span><span class="kt">Validation</span><span class="o">]</span> <span class="n">compose</span> 
	<span class="n">liftM</span><span class="o">[</span><span class="kt">List</span><span class="o">]</span>

<span class="k">val</span> <span class="n">yeah</span> <span class="k">=</span> <span class="n">crazy</span><span class="o">(</span><span class="n">square</span><span class="o">)</span>
<span class="k">val</span> <span class="n">orly</span> <span class="k">=</span> <span class="n">yeah</span><span class="o">(</span><span class="n">srlsly</span><span class="o">)</span>

<span class="c1">//the big sell</span>

<span class="k">val</span> <span class="n">srlsly</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Validation</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Things</span><span class="o">]]]]</span> <span class="k">=</span> <span class="o">...</span>
<span class="k">val</span> <span class="n">yupRly</span> <span class="k">=</span> <span class="n">srlsly</span><span class="o">.</span><span class="n">liftMap</span><span class="o">(</span><span class="n">square</span><span class="o">)</span>

<span class="n">whenReady</span><span class="o">(</span><span class="n">yupRly</span><span class="o">){</span> <span class="n">value</span> <span class="k">=&gt;</span>
	<span class="n">same</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Validation</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]]](</span><span class="n">value</span><span class="o">,</span> <span class="nc">Some</span><span class="o">(</span><span class="nc">Success</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">9</span><span class="o">))))</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">flOpt</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]]</span> <span class="k">=</span> <span class="o">...</span>

<span class="k">val</span> <span class="n">flInt</span> <span class="k">=</span> <span class="n">flOpt</span><span class="o">.</span><span class="n">liftMap</span><span class="o">{</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">}</span>
<span class="n">whenReady</span><span class="o">(</span><span class="n">flInt</span><span class="o">){</span> <span class="n">value</span> <span class="k">=&gt;</span>
	<span class="n">same</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]](</span><span class="n">value</span><span class="o">,</span> <span class="nc">List</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span>
<span class="o">}</span>

<span class="n">flOpt</span><span class="o">.</span><span class="n">liftFlatMap</span><span class="o">{</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span>
	<span class="k">if</span><span class="o">(</span><span class="n">x</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="nc">Some</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="k">else</span> <span class="nc">None</span>
<span class="o">}</span>

<span class="c1">//mapped</span>

<span class="k">def</span> <span class="n">liftMap</span><span class="o">[</span><span class="kt">B</span>, <span class="kt">C</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=&gt;</span> <span class="n">C</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">lift</span><span class="k">:</span> <span class="kt">LiftF</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>, <span class="kt">B</span> <span class="k">=&gt;</span> <span class="kt">C</span><span class="o">])</span><span class="k">:</span> <span class="kt">lift.Out</span> <span class="o">=</span> <span class="n">lift</span><span class="o">(</span><span class="n">fa</span><span class="o">,</span> <span class="n">f</span><span class="o">)</span>

<span class="k">def</span> <span class="n">liftAp</span><span class="o">[</span><span class="kt">B</span>, <span class="kt">C</span>, <span class="kt">M</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="n">f</span><span class="k">:</span> <span class="kt">M</span><span class="o">[</span><span class="kt">B</span> <span class="k">=&gt;</span> <span class="kt">C</span><span class="o">])</span>
<span class="k">def</span> <span class="n">liftFlatMap</span><span class="o">[</span><span class="kt">B</span>, <span class="kt">C</span>, <span class="kt">M</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="n">f</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=&gt;</span> <span class="n">M</span><span class="o">[</span><span class="kt">C</span><span class="o">])</span>
<span class="k">def</span> <span class="n">liftFoldLeft</span><span class="o">[</span><span class="kt">B</span>, <span class="kt">Z</span><span class="o">](</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)(</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">Z</span><span class="o">,</span> <span class="kt">B</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">Z</span><span class="o">)</span>
<span class="k">def</span> <span class="n">liftFoldRight</span><span class="o">[</span><span class="kt">B</span>, <span class="kt">Z</span><span class="o">](</span><span class="n">z</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)(</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">B</span><span class="o">,</span> <span class="o">=&gt;</span> <span class="n">Z</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">Z</span><span class="o">)</span>
<span class="k">def</span> <span class="n">liftFold</span>
<span class="k">def</span> <span class="n">liftFoldMap</span><span class="o">[</span><span class="kt">B</span>, <span class="kt">C</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=&gt;</span> <span class="n">C</span><span class="o">)</span>
<span class="k">def</span> <span class="n">liftFoldAt</span><span class="o">[</span><span class="kt">M</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span>
<span class="k">def</span> <span class="n">liftFilter</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=&gt;</span> <span class="nc">Boolean</span><span class="o">)</span>
<span class="k">def</span> <span class="n">liftFlatten</span><span class="o">[</span><span class="kt">M</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span>

<span class="c1">//lifters</span>

<span class="k">sealed</span> <span class="k">class</span> <span class="nc">LiftedMap</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">){</span>
	<span class="k">def</span> <span class="n">andThen</span><span class="o">[</span><span class="kt">C</span> <span class="k">&gt;:</span> <span class="kt">B</span>, <span class="kt">D</span><span class="o">](</span><span class="n">that</span><span class="k">:</span> <span class="kt">LiftedMap</span><span class="o">[</span><span class="kt">C</span>, <span class="kt">D</span><span class="o">])</span> <span class="k">=</span> <span class="n">that</span> <span class="n">compose</span> <span class="k">this</span>

	<span class="k">def</span> <span class="n">compose</span><span class="o">[</span><span class="kt">C</span>, <span class="kt">D</span> <span class="k">&lt;:</span> <span class="kt">A</span><span class="o">](</span><span class="n">that</span><span class="k">:</span> <span class="kt">LiftedMap</span><span class="o">[</span><span class="kt">C</span>, <span class="kt">D</span><span class="o">])</span> <span class="k">=</span> <span class="n">that</span> <span class="n">map</span> <span class="n">f</span>

	<span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">C</span><span class="o">](</span><span class="n">g</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=&gt;</span> <span class="n">C</span><span class="o">)</span><span class="k">:</span> <span class="kt">LiftedMap</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">C</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LiftedMap</span><span class="o">(</span><span class="n">f</span> <span class="n">andThen</span> <span class="n">g</span><span class="o">)</span>

	<span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">That</span><span class="o">](</span><span class="n">that</span><span class="k">:</span> <span class="kt">That</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">lift</span><span class="k">:</span> <span class="kt">LiftF</span><span class="o">[</span><span class="kt">That</span>, <span class="kt">A</span> <span class="k">=&gt;</span> <span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">lift.Out</span> <span class="o">=</span> <span class="n">lift</span><span class="o">(</span><span class="n">that</span><span class="o">,</span> <span class="n">f</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">def</span> <span class="n">liftMap</span><span class="o">[</span><span class="kt">B</span>, <span class="kt">C</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=&gt;</span> <span class="n">C</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LiftedMap</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>
<span class="k">def</span> <span class="n">liftAp</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span>, <span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="n">f</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span> <span class="k">=&gt;</span> <span class="kt">B</span><span class="o">])(</span><span class="k">implicit</span> <span class="n">ap</span><span class="k">:</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">F</span><span class="o">])</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LiftedAp</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>
<span class="k">def</span> <span class="n">liftFlatMap</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span>, <span class="kt">M</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">M</span><span class="o">[</span><span class="kt">B</span><span class="o">])(</span><span class="k">implicit</span> <span class="n">bind</span><span class="k">:</span> <span class="kt">Bind</span><span class="o">[</span><span class="kt">M</span><span class="o">])</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LiftedFlatMap</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>
<span class="k">def</span> <span class="n">liftFoldMap</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">m</span><span class="k">:</span> <span class="kt">Monoid</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LiftedFoldMap</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>
<span class="k">def</span> <span class="n">liftFilter</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Boolean</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LiftedFilter</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>
<span class="k">def</span> <span class="n">liftA2</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span>, <span class="kt">C</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span> <span class="kt">B</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">C</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LiftedA2</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>
<span class="k">def</span> <span class="n">liftA3</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span>, <span class="kt">C</span>, <span class="kt">D</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span> <span class="kt">B</span><span class="o">,</span> <span class="n">C</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LiftedA3</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>
<span class="k">def</span> <span class="n">liftM2</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span>, <span class="kt">C</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span> <span class="kt">B</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">C</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LiftedM2</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>
<span class="k">def</span> <span class="n">liftM3</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span>, <span class="kt">C</span>, <span class="kt">D</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span> <span class="kt">B</span><span class="o">,</span> <span class="n">C</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LiftedM3</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>

<span class="k">val</span> <span class="n">add</span> <span class="k">=</span> <span class="n">liftM2</span><span class="o">{</span> <span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">y</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span> <span class="o">}</span>

<span class="k">val</span> <span class="n">one</span> <span class="k">=</span> <span class="n">add</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))</span>
<span class="k">val</span> <span class="n">two</span> <span class="k">=</span> <span class="n">add</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="nc">Option</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="nc">None</span><span class="o">),</span> <span class="nc">List</span><span class="o">(</span><span class="nc">Option</span><span class="o">(</span><span class="mi">3</span><span class="o">)))</span>

<span class="n">same</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]](</span><span class="n">two</span><span class="o">,</span> <span class="nc">List</span><span class="o">(</span><span class="nc">Option</span><span class="o">(</span><span class="mi">4</span><span class="o">)))</span>

<span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">That</span><span class="o">](</span><span class="n">that</span><span class="k">:</span> <span class="kt">That</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">lift</span><span class="k">:</span> <span class="kt">LiftF</span><span class="o">[</span><span class="kt">That</span>, <span class="kt">A</span> <span class="k">=&gt;</span> <span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">lift.Out</span> <span class="o">=</span> 
	<span class="n">lift</span><span class="o">(</span><span class="n">that</span><span class="o">,</span> <span class="n">f</span><span class="o">)</span>

<span class="c1">//final</span>

<span class="k">val</span> <span class="n">out</span> <span class="k">=</span> <span class="k">for</span><span class="o">{</span>
	<span class="n">item1</span> <span class="k">&lt;-</span> <span class="n">list1</span> <span class="c1">//flatMap</span>
	<span class="n">item2</span> <span class="k">&lt;-</span> <span class="n">list2</span> <span class="c1">//map</span>
<span class="o">}</span> <span class="k">yield</span> <span class="n">item1</span> <span class="o">+</span> <span class="n">item2</span>

<span class="k">val</span> <span class="n">out</span> <span class="k">=</span> <span class="k">for</span><span class="o">{</span>
	<span class="n">item1</span> <span class="k">&lt;-</span> <span class="n">futList1</span> <span class="c1">//liftFlatMap</span>
	<span class="n">item2</span> <span class="k">&lt;-</span> <span class="n">futList2</span> <span class="c1">//liftMap</span>
<span class="o">}</span> <span class="k">yield</span> <span class="n">item1</span> <span class="o">+</span> <span class="n">item2</span>

<span class="c1">//compiler error</span>
<span class="nc">Option</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="n">liftMap</span><span class="o">{</span>
	<span class="k">case</span> <span class="nc">List</span><span class="o">(</span><span class="n">v</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">v</span>
	<span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="mi">0</span>
<span class="o">}</span>

<span class="c1">//</span>

<span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;com.github.wheaties&quot;</span> <span class="o">%%</span> <span class="s">&quot;autolift&quot;</span> <span class="o">%</span> <span class="s">&quot;0.2&quot;</span>

<span class="c1">//plugins</span>

<span class="n">resolvers</span> <span class="o">+=</span> <span class="nc">Resolver</span><span class="o">.</span><span class="n">url</span><span class="o">(</span>
  <span class="s">&quot;tpolecat-sbt-plugin-releases&quot;</span><span class="o">,</span>
    <span class="n">url</span><span class="o">(</span><span class="s">&quot;http://dl.bintray.com/content/tpolecat/sbt-plugin-releases&quot;</span><span class="o">))(</span>
        <span class="nc">Resolver</span><span class="o">.</span><span class="n">ivyStylePatterns</span><span class="o">)</span>

<span class="n">addSbtPlugin</span><span class="o">(</span><span class="s">&quot;org.tpolecat&quot;</span> <span class="o">%</span> <span class="s">&quot;tut-plugin&quot;</span> <span class="o">%</span> <span class="s">&quot;0.4.0&quot;</span><span class="o">)</span>

<span class="n">addSbtPlugin</span><span class="o">(</span><span class="s">&quot;org.xerial.sbt&quot;</span> <span class="o">%</span> <span class="s">&quot;sbt-sonatype&quot;</span> <span class="o">%</span> <span class="s">&quot;0.5.1&quot;</span><span class="o">)</span>

<span class="n">addSbtPlugin</span><span class="o">(</span><span class="s">&quot;com.jsuereth&quot;</span> <span class="o">%</span> <span class="s">&quot;sbt-pgp&quot;</span> <span class="o">%</span> <span class="s">&quot;1.0.0&quot;</span><span class="o">)</span>

<span class="n">addSbtPlugin</span><span class="o">(</span><span class="s">&quot;com.typesafe.sbt&quot;</span> <span class="o">%</span> <span class="s">&quot;sbt-site&quot;</span> <span class="o">%</span> <span class="s">&quot;0.8.2&quot;</span><span class="o">)</span>

<span class="n">addSbtPlugin</span><span class="o">(</span><span class="s">&quot;com.typesafe.sbt&quot;</span> <span class="o">%</span> <span class="s">&quot;sbt-ghpages&quot;</span> <span class="o">%</span> <span class="s">&quot;0.5.4&quot;</span><span class="o">)</span>

<span class="n">addSbtPlugin</span><span class="o">(</span><span class="s">&quot;com.eed3si9n&quot;</span> <span class="o">%</span> <span class="s">&quot;sbt-unidoc&quot;</span> <span class="o">%</span> <span class="s">&quot;0.3.3&quot;</span><span class="o">)</span>
</pre></div>
